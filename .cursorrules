# ============================================
# âš™ï¸ CONFIGURACIÃ“N DE CURSOR
# MAPA MADRE ADAPTATIVO DEL PROYECTO
# ============================================
# Este archivo define los comandos inteligentes que gestionan
# la creaciÃ³n, actualizaciÃ³n y mantenimiento del Mapa Madre Adaptativo.
# --------------------------------------------

rules:

  # ==========================================================
  # 1ï¸âƒ£ CreaciÃ³n inicial del mapa madre (prompt integral)
  # ==========================================================
  - when: "El usuario escriba @mapa_madre_adaptativo"
    then: |
      ğŸ§­ **Objetivo General:**  
      Generar desde cero un **MAPA MADRE ADAPTATIVO Y DE CONFIABILIDAD** del repositorio actual.  
      
      Este documento serÃ¡ la **fuente de verdad viva** del proyecto, y debe:
      - Mapear toda la estructura, funciones y dependencias.
      - Detectar integraciones externas (Supabase, Kapso, APIs, SDKs, etc.).
      - Clasificar cada mÃ³dulo por nivel de certeza funcional.
      - Representar el flujo de datos, puntos de entrada y arquitectura.
      - Servir como base para debugging, integraciones y mantenimiento.

      ---
      ### ğŸ§© 1. DetecciÃ³n del stack
      Analiza el proyecto para inferir frameworks, backend, DB, integraciones y lenguajes.  
      Resume los hallazgos en una secciÃ³n **"Stack Inferido"**.

      ---
      ### âš™ï¸ 2. Mapeo estructural
      Crea un Ã¡rbol jerÃ¡rquico con todas las carpetas y archivos.  
      Describe brevemente el propÃ³sito de cada archivo y clasifÃ­calo (UI, lÃ³gica, integraciÃ³n, config, etc.).

      ---
      ### ğŸ§  3. Mapeo funcional
      Dentro de cada archivo, lista todas las funciones, clases o componentes.  
      Crea una tabla con:
      `Nombre | Tipo | DescripciÃ³n | Dependencias | Estado (ğŸŸ© Estable / ğŸŸ¨ RevisiÃ³n / ğŸŸ¥ Incierto / ğŸŸ¦ Indeterminado)`

      ---
      ### âš ï¸ 4. Sistema de confiabilidad
      EvalÃºa la solidez de cada mÃ³dulo segÃºn:
      - claridad del cÃ³digo
      - tipado o tests
      - presencia de comentarios TODO/FIXME
      - estabilidad percibida  
      Genera un **Mapa de Confiabilidad Global** (por ejemplo, un resumen con porcentajes o emojis ğŸŸ©ğŸŸ¨ğŸŸ¥).

      ---
      ### ğŸ”— 5. Dependencias y flujo
      Genera diagramas **Mermaid** del flujo general:
      UI â†’ API â†’ Supabase â†’ DB â†’ Integraciones externas (Kapso, etc.).  
      Usa colores o etiquetas para reflejar el nivel de confianza.

      ---
      ### ğŸ§© 6. Arquitectura lÃ³gica
      Agrupa por capas (UI, lÃ³gica, integraciones, persistencia, utilidades).  
      Explica cÃ³mo interactÃºan y marca acoplamientos o anomalÃ­as âš ï¸.

      ---
      ### ğŸ§­ 7. Puntos crÃ­ticos y debugging
      Enumera mÃ³dulos o funciones inestables (ğŸŸ¥).  
      Explica riesgos, dependencias sensibles y estrategias de debugging o refactor seguro.

      ---
      ### ğŸ§° 8. Formato y entrega
      - Usa Markdown estructurado.
      - Incluye diagramas Mermaid y tablas.
      - Guarda el archivo en: `/docs/MAPA_MADRE_ADAPTATIVO.md`.
      - AÃ±ade fecha y versiÃ³n en el encabezado.

      ---
      ### ğŸ¯ PropÃ³sito final
      ServirÃ¡ como **base tÃ©cnica viva** del proyecto.
      Prioriza **precisiÃ³n, trazabilidad y claridad**.
      Si hay dudas, mÃ¡rcalas como ğŸŸ¥ Incierto con una breve explicaciÃ³n.


  # ==========================================================
  # 2ï¸âƒ£ ActualizaciÃ³n incremental del mapa
  # ==========================================================
  - when: "El usuario escriba @update_mapa"
    then: |
      Actualiza el archivo `/docs/MAPA_MADRE_ADAPTATIVO.md` considerando los Ãºltimos cambios del cÃ³digo.

      - Revisa quÃ© archivos, funciones o mÃ³dulos se modificaron desde la Ãºltima versiÃ³n.
      - Actualiza su descripciÃ³n, dependencias y nivel de certeza (ğŸŸ©ğŸŸ¨ğŸŸ¥ğŸŸ¦).
      - AÃ±ade nuevas integraciones si las detectas.
      - MantÃ©n intactas las secciones no afectadas.
      - Al final del documento, agrega una entrada en **"Historial de Cambios del Mapa"** con fecha y descripciÃ³n breve.
        Ejemplo:
        - 2025-10-24: Estabilizado mÃ³dulo `/api/users.js` (ğŸŸ©)
        - 2025-10-25: Nueva integraciÃ³n detectada con Kapso `/syncWorkflow`

      No regeneres todo el documento, solo actualiza las secciones afectadas.


  # ==========================================================
  # 3ï¸âƒ£ ReconstrucciÃ³n total del mapa
  # ==========================================================
  - when: "El usuario escriba @rebuild_mapa"
    then: |
      Regenera **desde cero** el archivo `/docs/MAPA_MADRE_ADAPTATIVO.md`, usando las mismas reglas que @mapa_madre_adaptativo.
      No reutilices contenido anterior.
      Crea nuevamente toda la estructura, funciones, dependencias y flujos.
      Incluye una nota de versiÃ³n en el encabezado indicando que es una reconstrucciÃ³n completa.


  # ==========================================================
  # 4ï¸âƒ£ Sugerencia automÃ¡tica de actualizaciÃ³n
  # ==========================================================
  - when: "El repositorio cambie significativamente (commits, merges o nuevos archivos)"
    then: |
      Sugerir automÃ¡ticamente al usuario:
      "He detectado cambios en el cÃ³digo. Â¿Deseas ejecutar `@update_mapa` para mantener actualizado el Mapa Madre Adaptativo?"
